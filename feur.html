<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <title>Quoi?</title>
    <link rel="manifest" href="./feur.webmanifest?v=1">
    <link rel="icon" href="./quoi.svg" type="image/svg+xml"/>
    <link rel="apple-touch-icon" href="./quoi.svg" type="image/svg+xml"/>

    <style>

        body, html, #leBody {
            overflow: hidden;
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
        }

        body {
            will-change: background-color;
        }

        .feur {
            position: absolute;
            transition: left 400ms ease-in-out, top 400ms ease-in-out, transform 400ms ease-in-out;
            transform: translateZ(0);
            will-change: left, top, transform;
        }

        #labelQuoi {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

    </style>

</head>

<body>
<div id="leBody">
    <div id="avertissementRelou">
        Note: images flash and may cause seizures. Please be careful.
    </div>
    <label for="quoi" id="labelQuoi">
        Ã‰crit "quoi ?" mon reuf
        <input type="text" id="quoi" placeholder="Quoi?">
    </label>
</div>
</body>

<script type="application/javascript">
    const inputQuoi = document.getElementById('quoi');
    const labelQuoi = document.getElementById('labelQuoi');
    const leBody = document.getElementById('leBody');
    const avertissementRelou = document.getElementById('avertissementRelou');

    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("sw.js");
    }

    document.addEventListener("DOMContentLoaded", () => {
        inputQuoi.focus();

        inputQuoi.addEventListener("blur", () => {
            inputQuoi.focus();
        });

        inputQuoi.addEventListener('input', (e) => {
            if ("QUOI?" === e.target.value.trim().toUpperCase()
                || "QUOI ?" === e.target.value.trim().toUpperCase()) {
                ejfrgkjjnv();
            }
        });

        window.addEventListener("resize", () => {
            for (const ceFeur of document.getElementsByClassName("feur")) {
                majFeur(ceFeur);
            }
        });
    });

    function ecritureFeurAleatoire() {
        const tableauFeur = ['feur', 'feuR', 'feUr', 'feUR', 'fEur', 'fEuR', 'fEUr', 'fEUR', 'Feur', 'FeuR', 'FeUr', 'FeUR', 'FEur', 'FEuR', 'FEUr', 'FEUR', 'feur!', 'feuR!', 'feUr!', 'feUR!', 'fEur!', 'fEuR!', 'fEUr!', 'fEUR!', 'Feur!', 'FeuR!', 'FeUr!', 'FeUR!', 'FEur!', 'FEuR!', 'FEUr!', 'FEUR!',];
        return tableauFeur[Math.floor(Math.random() * tableauFeur.length)];
    }

    function couleurCSSAleatoire() {
        return `rgb(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)})`;
    }

    function yAleatoire(tailleTexte) {
        const hauteurPage = leBody.getBoundingClientRect().height - tailleTexte;
        return Math.floor(Math.random() * hauteurPage);
    }

    function xAleatoire(tailleTexte) {
        const largeurPage = leBody.getBoundingClientRect().width - tailleTexte;
        return Math.floor(Math.random() * largeurPage);
    }

    function rotationAleatoire() {
        return Math.floor(Math.random() * 90) - 45;
    }

    function majFeur(ceFeur) {
        ceFeur.innerHTML = ecritureFeurAleatoire();
        ceFeur.style.transform = `rotate(${rotationAleatoire()}deg)`;
        ceFeur.style.color = couleurCSSAleatoire();
        ceFeur.style.left = xAleatoire(ceFeur.getBoundingClientRect().width + 20) + "px";
        ceFeur.style.top = yAleatoire(ceFeur.getBoundingClientRect().height + 20) + "px";
    }

    function ejfrgkjjnv() {
        labelQuoi.remove();
        avertissementRelou.remove();

        const nbFeur = undefined ?? Math.floor(leBody.getBoundingClientRect().width * leBody.getBoundingClientRect().height / 5000);

        for (let i = 0; i < nbFeur; i++) {
            const tempsReactionInitial = Math.floor(Math.random() * 200);
            const tempsReactionFeur = Math.floor(Math.random() * 50) * 70 + 1000;
            const ceFeur = document.createElement('h1');
            ceFeur.classList.add('feur');
            majFeur(ceFeur);
            leBody.appendChild(ceFeur);

            setTimeoutWithRAF(() => {
                majFeur(ceFeur);
            }, tempsReactionInitial);

            setIntervalWithRAF(() => {
                majFeur(ceFeur);
            }, tempsReactionFeur);
        }

        document.title = ecritureFeurAleatoire();
        document.body.style.backgroundColor = couleurCSSAleatoire();
        setInterval(() => {
            document.title = ecritureFeurAleatoire();
            document.body.style.backgroundColor = couleurCSSAleatoire();
        }, 500);

    }

    function setIntervalWithRAF(callback, interval) {
        let lastTime = 0;

        function loop(time) {
            if (time - lastTime >= interval) {
                lastTime = time;
                callback();
            }
            requestAnimationFrame(loop);
        }

        requestAnimationFrame(loop);
    }

    function setTimeoutWithRAF(callback, timeout) {
        let lastTime = 0;

        function loop(time) {
            if (time - lastTime >= timeout) {
                lastTime = time;
                callback();
            } else {
                requestAnimationFrame(loop);
            }
        }

        requestAnimationFrame(loop);
    }


</script>

</html>
