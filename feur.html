<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quoi?</title>
    <link rel="icon"
          href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'%3E%3Ccircle fill='%23FFCB4C' cx='18' cy='17.018' r='17'/%3E%3Cpath fill='%2365471B' d='M14.524 21.036c-.145-.116-.258-.274-.312-.464-.134-.46.13-.918.59-1.021 4.528-1.021 7.577 1.363 7.706 1.465.384.306.459.845.173 1.205-.286.358-.828.401-1.211.097-.11-.084-2.523-1.923-6.182-1.098-.274.061-.554-.016-.764-.184z'/%3E%3Cellipse fill='%2365471B' cx='13.119' cy='11.174' rx='2.125' ry='2.656'/%3E%3Cellipse fill='%2365471B' cx='24.375' cy='12.236' rx='2.125' ry='2.656'/%3E%3Cpath fill='%23F19020' d='M17.276 35.149s1.265-.411 1.429-1.352c.173-.972-.624-1.167-.624-1.167s1.041-.208 1.172-1.376c.123-1.101-.861-1.363-.861-1.363s.97-.4 1.016-1.539c.038-.959-.995-1.428-.995-1.428s5.038-1.221 5.556-1.341c.516-.12 1.32-.615 1.069-1.694-.249-1.08-1.204-1.118-1.697-1.003-.494.115-6.744 1.566-8.9 2.068l-1.439.334c-.54.127-.785-.11-.404-.512.508-.536.833-1.129.946-2.113.119-1.035-.232-2.313-.433-2.809-.374-.921-1.005-1.649-1.734-1.899-1.137-.39-1.945.321-1.542 1.561.604 1.854.208 3.375-.833 4.293-2.449 2.157-3.588 3.695-2.83 6.973.828 3.575 4.377 5.876 7.952 5.048l3.152-.681z'/%3E%3Cpath fill='%2365471B' d='M9.296 6.351c-.164-.088-.303-.224-.391-.399-.216-.428-.04-.927.393-1.112 4.266-1.831 7.699-.043 7.843.034.433.231.608.747.391 1.154-.216.405-.74.546-1.173.318-.123-.063-2.832-1.432-6.278.047-.257.109-.547.085-.785-.042zm12.135 3.75c-.156-.098-.286-.243-.362-.424-.187-.442.023-.927.468-1.084 4.381-1.536 7.685.48 7.823.567.415.26.555.787.312 1.178-.242.39-.776.495-1.191.238-.12-.072-2.727-1.621-6.267-.379-.266.091-.553.046-.783-.096z'/%3E%3C/svg%3E"
          type="image/svg+xml"/>

    <style>

        body, html, #leBody {
            overflow: hidden;
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
        }

        body {
            will-change: background-color;
        }

        .feur {
            position: absolute;
            transition: left 400ms ease-in-out, top 400ms ease-in-out, transform 400ms ease-in-out;
            transform: translateZ(0);
            will-change: left, top, transform;
        }

        #labelQuoi {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

    </style>

</head>

<body>
<div id="leBody">
    <div id="avertissementRelou">
        Note: images flash and may cause seizures. Please be careful.
    </div>
    <label for="quoi" id="labelQuoi">
        Ã‰crit "quoi ?" mon reuf
        <input type="text" id="quoi" placeholder="Quoi?">
    </label>
</div>
</body>

<script type="application/javascript">
    const inputQuoi = document.getElementById('quoi');
    const labelQuoi = document.getElementById('labelQuoi');
    const leBody = document.getElementById('leBody');
    const avertissementRelou = document.getElementById('avertissementRelou');

    document.addEventListener("DOMContentLoaded", () => {
        inputQuoi.focus();

        inputQuoi.addEventListener("blur", () => {
            inputQuoi.focus();
        });

        inputQuoi.addEventListener('input', (e) => {
            if ("QUOI?" === e.target.value.trim().toUpperCase()
                || "QUOI ?" === e.target.value.trim().toUpperCase()) {
                ejfrgkjjnv();
            }
        });

        window.addEventListener("resize", () => {
            console.log("resize");
            for (const ceFeur of document.getElementsByClassName("feur")) {
                majFeur(ceFeur);
            }
        });
    });

    function ecritureFeurAleatoire() {
        const tableauFeur = ['feur', 'feuR', 'feUr', 'feUR', 'fEur', 'fEuR', 'fEUr', 'fEUR', 'Feur', 'FeuR', 'FeUr', 'FeUR', 'FEur', 'FEuR', 'FEUr', 'FEUR', 'feur!', 'feuR!', 'feUr!', 'feUR!', 'fEur!', 'fEuR!', 'fEUr!', 'fEUR!', 'Feur!', 'FeuR!', 'FeUr!', 'FeUR!', 'FEur!', 'FEuR!', 'FEUr!', 'FEUR!',];
        return tableauFeur[Math.floor(Math.random() * tableauFeur.length)];
    }

    function couleurCSSAleatoire() {
        return `rgb(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)})`;
    }

    function yAleatoire(tailleTexte) {
        const hauteurPage = leBody.getBoundingClientRect().height - tailleTexte;
        return Math.floor(Math.random() * hauteurPage);
    }

    function xAleatoire(tailleTexte) {
        const largeurPage = leBody.getBoundingClientRect().width - tailleTexte;
        return Math.floor(Math.random() * largeurPage);
    }

    function rotationAleatoire() {
        return Math.floor(Math.random() * 90) - 45;
    }

    function majFeur(ceFeur) {
        ceFeur.innerHTML = ecritureFeurAleatoire();
        ceFeur.style.transform = `rotate(${rotationAleatoire()}deg)`;
        ceFeur.style.color = couleurCSSAleatoire();
        ceFeur.style.left = xAleatoire(ceFeur.getBoundingClientRect().width + 20) + "px";
        ceFeur.style.top = yAleatoire(ceFeur.getBoundingClientRect().height + 20) + "px";
    }

    function ejfrgkjjnv() {
        labelQuoi.remove();
        avertissementRelou.remove();

        const nbFeur = undefined ?? Math.floor(leBody.getBoundingClientRect().width * leBody.getBoundingClientRect().height / 5000);

        for (let i = 0; i < nbFeur; i++) {
            const tempsReactionInitial = Math.floor(Math.random() * 200);
            const tempsReactionFeur = Math.floor(Math.random() * 50) * 70 + 1000;
            const ceFeur = document.createElement('h1');
            ceFeur.classList.add('feur');
            majFeur(ceFeur);
            leBody.appendChild(ceFeur);

            setTimeoutWithRAF(() => {
                majFeur(ceFeur);
            }, tempsReactionInitial);

            setIntervalWithRAF(() => {
                majFeur(ceFeur);
            }, tempsReactionFeur);
        }

        document.title = ecritureFeurAleatoire();
        document.body.style.backgroundColor = couleurCSSAleatoire();
        setInterval(() => {
            document.title = ecritureFeurAleatoire();
            document.body.style.backgroundColor = couleurCSSAleatoire();
        }, 500);

    }

    function setIntervalWithRAF(callback, interval) {
        let lastTime = 0;

        function loop(time) {
            if (time - lastTime >= interval) {
                lastTime = time;
                callback();
            }
            requestAnimationFrame(loop);
        }

        requestAnimationFrame(loop);
    }

    function setTimeoutWithRAF(callback, timeout) {
        let lastTime = 0;

        function loop(time) {
            if (time - lastTime >= timeout) {
                lastTime = time;
                callback();
            } else {
                requestAnimationFrame(loop);
            }
        }

        requestAnimationFrame(loop);
    }


</script>

</html>
